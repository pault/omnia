<NODE><INFO>rendered by Everything::XML.pm</INFO>
	<author_user table="node" type="usergroup">gods</author_user>
	<authoraccess table="node">iiii</authoraccess>
	<code table="htmlcode">my ($size) = @_;
my ($big, $small, @order);
$big = 1 if (lc($size) eq 'big');
$small = 1 if (lc($size) eq 'small');

my ($settings, $vars) = $DB-&gt;getNode('task settings', 'setting');
$vars = $settings-&gt;getVars() if $settings;

my %fields = ( title =&gt; 'title',
	status 	 =&gt; 'status',
 	owner 	 =&gt; 'owner',
	category =&gt; 'category',
	rating	 =&gt; 'rating',
	due =&gt; 'due_date');

if ($small) {
	@order = split(/\s*,\s*/, $VARS-&gt;{'small_task_list_order'});
	@order = ('title','rating','due') unless (scalar @order);
} elsif ($big) {
	if ($vars &amp;&amp; exists($vars-&gt;{'task list order'})) {
		@order = split(/\s*,\s*/, $vars-&gt;{'task_list_order'});
	} else {
		@order = ('title','category','status','rating','due');
	}
} else {
	@order = ('title','category','status','rating','due');
}

my $orderby = $query-&gt;param('sortby') || $VARS-&gt;{task_orderby};
unless ((defined $orderby) || (exists $fields{$orderby})) {
	$orderby = 'due';
}
$orderby = $fields{$orderby};

my $moreorder = '';
my $order = $query-&gt;param('order');
$order = $VARS-&gt;{task_list_sort_order} unless (defined $order);
$order = 0 unless (defined $order &amp;&amp; $order =~ /^[01]$/);
$moreorder .= " DESC" if ($order);

my (@where, $checked);
push @where, "owner = '$USER-&gt;{user_id}'" unless ($big);

$checked = $VARS-&gt;{task_no_closed} || 0;
if ($query-&gt;param('no_closed') =~ /^[01]$/) {
	$VARS-&gt;{task_no_closed} = ($checked = $query-&gt;param('no_closed')) ? 1 : '';
}
push @where, "status &lt;&gt; 'closed'" if $checked;

if ($small) {
	$moreorder .= " limit " . ($VARS-&gt;{'small_task_list_limit'} || '8');
}

my $cursor = $DB-&gt;getNodeCursor(join(", ", @fields{@order}, 'task_id'), 
	join(" and ", @where), 'task', $orderby . $moreorder);
return 'None found in database!' unless $cursor;
return 'Database call failed!' unless $cursor-&gt;execute();

my ($str, $open, $close);

if ($small) {
	$str = '&lt;table cellpadding="2" width="145" align="center"&gt;';
	$open = '&lt;td&gt;&lt;font size="2"&gt;';
	$close = '&lt;/font&gt;&lt;/td&gt;';
} else {
	$str .= qq|&lt;form method="POST"&gt;&lt;input type="hidden" name="node_id" value="$$NODE{node_id}"&gt;|;
	$str .= qq|&lt;table border=0&gt;&lt;tr&gt;&lt;th&gt;Include closed?&lt;/th&gt;&lt;th&gt;Sort Field&lt;/th&gt;&lt;th&gt;Sort Order&lt;/th&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;|;
	for (0 .. 1) {
		$str .= qq|&lt;input type="radio" name="no_closed" value="$_"|;
		$str .= " checked" if $_ == $checked;
		$str .= "&gt;" . ($_ == 0 ? "Yes" : "No") . "&lt;/input&gt;";
	}
	$str .= qq|&lt;/td&gt;&lt;td&gt;&lt;select name="sortby"&gt;|;
	foreach my $field (keys %fields) {
		$str .= "&lt;option";
		$str .= " selected" if ($field eq $orderby);
		$str .= qq| value="$field"&gt;$fields{$field}&lt;/option&gt;\n|;
	}
	$str .= qq|&lt;/select&gt;&lt;/td&gt;&lt;td&gt;&lt;select name="order"&gt;|;
	for (0 .. 1) {
		$str .= "&lt;option";
		$str .= " selected" if ($_ == $order);
		$str .= qq| value="$_"&gt;| . ($_ == 0 ? "Normal" : "Reverse") . "&lt;/option&gt;\n";
	}
	$str .= '&lt;/select&gt;&lt;/td&gt;&lt;td&gt;&lt;input type="submit" value="Refresh"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/form&gt;';
	$str .= '&lt;table cellpadding="5"&gt;';
	$open = '&lt;th&gt;';
	$close = '&lt;/th&gt;';
}

$str .= "&lt;tr&gt;$open";
$str .= join("$close$open", @order) . "$close&lt;/tr&gt;\n";

if ($small) {
	$open = '&lt;font size="2"&gt;';
	$close = '&lt;/font&gt;';
} else {
	$open = '';
	$close = '';
}

my @colors;
if ($vars and defined $vars-&gt;{row_colors}) {
	@colors = map { "bgcolor=\"$_\"" } split(/\s*,\s*/, $vars-&gt;{row_colors});
} else {
	@colors = ( 'bgcolor="#dddddd"', 'bgcolor="#eeeeee"' );
}

my $count = 0;
my $c = pop @colors;
while (my $task = $cursor-&gt;fetchrow_hashref()) {
	$count ||= 1;
	push @colors, $c;
	$c = shift @colors;
               
	$task-&gt;{title} = linkNode(getNodeById($task-&gt;{task_id}));
	$task-&gt;{owner} = linkNode(getNodeById($task-&gt;{owner}));

	$str.= "&lt;tr&gt;";
	foreach my $field (@fields{@order}) {
		$str.="&lt;td $c&gt;$open$task-&gt;{$field}$close&lt;/td&gt;";
	}
	$str.="&lt;/tr&gt;\n";
}
$cursor-&gt;finish();
$str .= "&lt;/table&gt;";
$str = "No tasks found.  Lucky." unless $count;
$str .= '&lt;p align="right"&gt;' . linkNodeTitle("Task lister preferences|edit view")
 	. " | " . linkNodeTitle("Task lister|lister") unless $big;
return $str;</code>
	<dynamicauthor_permission table="node">-1</dynamicauthor_permission>
	<dynamicgroup_permission table="node">-1</dynamicgroup_permission>
	<dynamicguest_permission table="node">-1</dynamicguest_permission>
	<dynamicother_permission table="node">-1</dynamicother_permission>
	<group_usergroup table="node">-1</group_usergroup>
	<groupaccess table="node">iiiii</groupaccess>
	<guestaccess table="node">iiiii</guestaccess>
	<loc_location table="node" type="location">htmlcode</loc_location>
	<otheraccess table="node">iiiii</otheraccess>
	<title table="node">tasklist</title>
	<type_nodetype table="node" type="nodetype">htmlcode</type_nodetype>
</NODE>