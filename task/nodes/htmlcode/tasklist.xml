<NODE><INFO>rendered by Everything::XML.pm</INFO>
	<author_user table="node" type="user">root</author_user>
	<authoraccess table="node">iiii</authoraccess>
	<code table="htmlcode">my ($size) = @_;
my ($big, $small, @order);
$big = 1 if (lc($size) eq 'big');
$small = 1 if (lc($size) eq 'small');

my ($settings, $vars) = $DB-&gt;getNode('task settings', 'setting');
$vars = $settings-&gt;getVars() if $settings;

my %fields = ( title =&gt; 'title',
	status 	 =&gt; 'status',
 	owner 	 =&gt; 'owner',
	category =&gt; 'category',
	rating	 =&gt; 'rating',
	due =&gt; 'due_date');

if ($small) {
	@order = split(/\s*,\s*/, $VARS-&gt;{'small_task_list_order'})
		|| ('title','rating','due');
} elsif ($big) {
	if ($vars &amp;&amp; exists($vars-&gt;{'task list order'})) {
		@order = split(/\s*,\s*/, $vars-&gt;{'task_list_order'});
	} else {
		@order = ('title','category','status','rating','due');
	}
} else {
	@order = ('title','category','status','rating','due');
}

my $orderby = $query-&gt;param('sortby') || $VARS-&gt;{task_orderby};
unless ((defined $orderby) || (exists $fields{$orderby})) {
	$orderby = 'due';
}
$orderby = $fields{$orderby};

my ($where, $checked);
$where = "owner = '$USER-&gt;{user_id}'" unless ($big);

if ($query-&gt;param('no_closed') or $VARS-&gt;{task_no_closed}) {
	$checked = " CHECKED";
	$where .= " status &lt;&gt; 'closed'";
	$$VARS{task_no_closed} = 1;
}

if ($small) {
	$orderby .= " limit " . ($VARS-&gt;{'small_task_list_limit'} || '8');
}

my $cursor = $DB-&gt;getNodeCursor(join(", ", @fields{@order}, 'task_id'), $where,
	'task', $orderby);
return 'None found in database!' unless $cursor;
return 'Database call failed!' unless $cursor-&gt;execute();

my ($str, $open, $close);

if ($small) {
	$str = '&lt;table cellpadding="2" width="145" align="center"&gt;';
	$open = '&lt;td&gt;&lt;font size="2"&gt;';
	$close = '&lt;/font&gt;&lt;/td&gt;';
} else {
	$str .= &lt;&lt;SORT;
&lt;form method="POST"&gt;
&lt;input type="hidden" name="node_id" value="$$NODE{node_id}"&gt;
&lt;input type="checkbox" name="no_closed"$checked&gt;Ignore closed tasks&lt;/input&gt;
&lt;select name="sortby"&gt;
SORT
	foreach my $field (keys %fields) {
		$str .= "&lt;option";
		$str .= " selected" if ($field eq $orderby);
		$str .= qq| value="$field"&gt;$fields{$field}&lt;/option&gt;\n|;
	}
	$str .= '&lt;/select&gt;&lt;input type="submit" value="sort"&gt;&lt;/form&gt;';
	$str .= '&lt;table cellpadding="5"&gt;';
	$open = '&lt;th&gt;';
	$close = '&lt;/th&gt;';
}

$str .= "&lt;tr&gt;$open";
$str .= join("$close$open", @order) . "$close&lt;/tr&gt;\n";

if ($small) {
	$open = '&lt;font size="2"&gt;';
	$close = '&lt;/font&gt;';
} else {
	$open = '';
	$close = '';
}

my @colors;
if ($vars and defined $vars-&gt;{row_colors}) {
	@colors = map { "bgcolor=\"$_\"" } split(/\s*,\s*/, $vars-&gt;{row_colors});
} else {
	@colors = ( 'bgcolor="#dddddd"', 'bgcolor="#eeeeee"' );
}

my $count = 0;
my $c = pop @colors;
while (my $task = $cursor-&gt;fetchrow_hashref()) {
	$count ||= 1;
	push @colors, $c;
	$c = shift @colors;
               
	$task-&gt;{title} = linkNode(getNodeById($task-&gt;{task_id}));
	$task-&gt;{owner} = linkNode(getNodeById($task-&gt;{owner}));

	$str.= "&lt;tr&gt;";
	foreach my $field (@fields{@order}) {
		$str.="&lt;td $c&gt;$open$task-&gt;{$field}$close&lt;/td&gt;";
	}
	$str.="&lt;/tr&gt;\n";
}
$cursor-&gt;finish();
$str .= "&lt;/table&gt;";
$str = "No tasks found.  Lucky." unless $count;
$str .= '&lt;p align="right"&gt;' . linkNodeTitle("Task lister preferences|edit view")
 	. " | " . linkNodeTitle("Task lister|lister") unless $big;
return $str;</code>
	<dynamicauthor_permission table="node">-1</dynamicauthor_permission>
	<dynamicgroup_permission table="node">-1</dynamicgroup_permission>
	<dynamicguest_permission table="node">-1</dynamicguest_permission>
	<dynamicother_permission table="node">-1</dynamicother_permission>
	<group_usergroup table="node">-1</group_usergroup>
	<groupaccess table="node">iiiii</groupaccess>
	<guestaccess table="node">iiiii</guestaccess>
	<loc_location table="node" type="location">htmlcode</loc_location>
	<otheraccess table="node">iiiii</otheraccess>
	<title table="node">tasklist</title>
	<type_nodetype table="node" type="nodetype">htmlcode</type_nodetype>
</NODE>