<NODE export_version="0.5" nodetype="superdoc" title="User settings">
  <field name="author_user" type="noderef" type_nodetype="user,nodetype">root</field>
  <field name="authoraccess" type="literal_value">iiii</field>
  <field name="doctext" type="literal_value">[{openform}]

[%
#[{checkvar:nodelets_off,Turn nodelets off}]&lt;br>
#Nodelet Header Color:[{setvar:nodelet_headerclr}]&lt;br>
#Nodelet Body Color:[{setvar:nodelet_textclr}]&lt;br>
#Nodelet align:[{setvar:nodelet_align}]&lt;br>
"";
%]
Nodelet group:[{varmenu:nodelet_group,nodeletgroup}]&lt;br>


Theme: [{themeselector}]


[%
my @nodelets;
@nodelets = split ",", $$VARS{nodelets} if (defined($$VARS{nodelets}));
my $PN = getNode('personal nodelet', 'nodelet');
return unless $PN;
return unless grep /^$$PN{node_id}$/, @nodelets;

my $name = "set_personalnode";
my $delname = "del_personalnode";
my $i =0;
my $limit = $HTMLVARS{personalNodeletLimit};
$limit||=10;

my @newnodes;
my $updateflag=0;
while (defined $query->param($name.$i)) {
  my $n=$query->param($name.$i);
  $n = htmlScreen($n);
  push(@newnodes, $n) unless 
    $query->param($delname.$i); 
  $query->param($delname.$i, "");
  $query->param($name.$i, "");
  $i++;
  last if $i >= $limit;
  $updateflag=1;
}
if ($updateflag) {
  my $newstr = join "&lt;br>",@newnodes;
  $$VARS{personal_nodelet} = $newstr;
}

my @nodes = split "&lt;br>", $$VARS{personal_nodelet};
$i=0;
my $str = "&lt;p>
Here's where you can edit your &lt;b>Personal Nodelet&lt;/b>:&lt;br>
&lt;ul>";
foreach (@nodes) {
  $query->param($name.$i, $_);
  $str.= $query->textfield($name.$i)
   .$query->checkbox($delname.$i,"",1,"remove?")
   ."&lt;br>";
  $i++;
}
$str.=$query->textfield($name.$i, "")
    ."&lt;br>" unless $i >= $limit;
$str.="&lt;/ul>";
$str;



%]

[{closeform}]</field>
  <field name="dynamicauthor_permission" type="literal_value">-1</field>
  <field name="dynamicgroup_permission" type="literal_value">-1</field>
  <field name="dynamicguest_permission" type="literal_value">-1</field>
  <field name="dynamicother_permission" type="literal_value">-1</field>
  <field name="group_usergroup" type="literal_value">-1</field>
  <field name="groupaccess" type="literal_value">iiii-</field>
  <field name="guestaccess" type="literal_value">iiii-</field>
  <field name="loc_location" type="noderef" type_nodetype="location,nodetype">superdoc</field>
  <field name="otheraccess" type="literal_value">iiii-</field>
  <field name="title" type="literal_value">User settings</field>
  <field name="type_nodetype" type="noderef" type_nodetype="nodetype,nodetype">superdoc</field>
</NODE>
