<NODE export_version="0.5" nodetype="superdoc" title="User settings">
  <field type="noderef" type_nodetype="user,nodetype" name="author_user">root</field>
  <field type="literal_value" name="authoraccess">iiii</field>
  <field type="literal_value" name="doctext">[{openform}]

[%
#[{checkvar:nodelets_off,Turn nodelets off}]&lt;br>
#Nodelet Header Color:[{setvar:nodelet_headerclr}]&lt;br>
#Nodelet Body Color:[{setvar:nodelet_textclr}]&lt;br>
#Nodelet align:[{setvar:nodelet_align}]&lt;br>
"";
%]
Nodelet group:[{varmenu:nodelet_group,nodeletgroup}]&lt;br>


Theme: [{themeselector}]


[%
my @nodelets = split ",", $$VARS{nodelets};
my $PN = getNode('personal nodelet', 'nodelet');
return unless $PN;
return unless grep /^$$PN{node_id}$/, @nodelets;

my $name = "set_personalnode";
my $delname = "del_personalnode";
my $i =0;
my $limit = $HTMLVARS{personalNodeletLimit};
$limit||=10;

my @newnodes;
my $updateflag=0;
while (defined $query->param($name.$i)) {
  my $n=$query->param($name.$i);
  $n = htmlScreen($n);
  push(@newnodes, $n) unless 
    $query->param($delname.$i); 
  $query->param($delname.$i, "");
  $query->param($name.$i, "");
  $i++;
  last if $i >= $limit;
  $updateflag=1;
}
if ($updateflag) {
  my $newstr = join "&lt;br>",@newnodes;
  $$VARS{personal_nodelet} = $newstr;
}

my @nodes = split "&lt;br>", $$VARS{personal_nodelet};
$i=0;
my $str = "&lt;p>
Here's where you can edit your &lt;b>Personal Nodelet&lt;/b>:&lt;br>
&lt;ul>";
foreach (@nodes) {
  $query->param($name.$i, $_);
  $str.= $query->textfield($name.$i)
   .$query->checkbox($delname.$i,"",1,"remove?")
   ."&lt;br>";
  $i++;
}
$str.=$query->textfield($name.$i, "")
    ."&lt;br>" unless $i >= $limit;
$str.="&lt;/ul>";
$str;



%]

[{closeform}]</field>
  <field type="literal_value" name="dynamicauthor_permission">-1</field>
  <field type="literal_value" name="dynamicgroup_permission">-1</field>
  <field type="literal_value" name="dynamicguest_permission">-1</field>
  <field type="literal_value" name="dynamicother_permission">-1</field>
  <field type="literal_value" name="group_usergroup">-1</field>
  <field type="literal_value" name="groupaccess">iiii-</field>
  <field type="literal_value" name="guestaccess">iiii-</field>
  <field type="noderef" type_nodetype="location,nodetype" name="loc_location">superdoc</field>
  <field type="literal_value" name="otheraccess">iiii-</field>
  <field type="literal_value" name="title">User settings</field>
  <field type="noderef" type_nodetype="nodetype,nodetype" name="type_nodetype">superdoc</field>
</NODE>
