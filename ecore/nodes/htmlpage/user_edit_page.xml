<NODE export_version="0.5" nodetype="htmlpage" title="user edit page">
  <field name="MIMEtype" type="literal_value">text/html</field>
  <field name="author_user" type="noderef" type_nodetype="user,nodetype">root</field>
  <field name="authoraccess" type="literal_value">iiii</field>
  <field name="displaytype" type="literal_value">edit</field>
  <field name="dynamicauthor_permission" type="literal_value">-1</field>
  <field name="dynamicgroup_permission" type="literal_value">-1</field>
  <field name="dynamicguest_permission" type="literal_value">-1</field>
  <field name="dynamicother_permission" type="literal_value">-1</field>
  <field name="group_usergroup" type="literal_value">-1</field>
  <field name="groupaccess" type="literal_value">iiii-</field>
  <field name="guestaccess" type="literal_value">iiii-</field>
  <field name="loc_location" type="noderef" type_nodetype="location,nodetype">htmlpage</field>
  <field name="otheraccess" type="literal_value">iiii-</field>
  <field name="ownedby_theme" type="literal_value">0</field>
  <field name="page" type="literal_value">[%
$GLOBAL{userFontAttr} = $$THEME{nodeletTitleFontAttr};
$GLOBAL{userFontAttr} ||= &quot;color=white&quot;;&quot;&quot;;
%]

&lt;table border=0 cellspacing=10&gt;
 &lt;tr bgcolor=[&quot;$$THEME{nodeletTitleColor}&quot;]&gt;&lt;td colspan=2&gt;
  &lt;font [&quot;$GLOBAL{userFontAttr}&quot;]&gt;&lt;b&gt;User Information&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
  &lt;td&gt;
  &lt;b&gt;Real Name&lt;/b&gt;: [&quot;$$NODE{realname}&quot;]&lt;br&gt;
  [{nodeFormObject: TextField, realname}]
 &lt;/td&gt;
 &lt;td&gt;
   &lt;b&gt;Email Address&lt;/b&gt;: [&quot;$$NODE{email}&quot;]&lt;br&gt;
   [{nodeFormObject: TextField, email, email, AUTO, 40, 255}]
 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=2&gt;
&lt;b&gt;User's Bio&lt;/B&gt;:&lt;br&gt;
[{nodeFormObject: TextArea, doctext}]
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
  &lt;td bgcolor=[&quot;$$THEME{nodeletTitleColor}&quot;]&gt;
   &lt;font [&quot;$GLOBAL{userFontAttr}&quot;]&gt;&lt;b&gt;Authentication&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
  &lt;td bgcolor=[&quot;$$THEME{nodeletTitleColor}&quot;]&gt;
   &lt;font [&quot;$GLOBAL{userFontAttr}&quot;]&gt;&lt;b&gt;Preferences&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
  &lt;td&gt;[{nodeFormObject: PasswdField, passwd, passwd, 1, 1}]&lt;/td&gt;
  &lt;td&gt;Theme: [{themeselector}]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td bgcolor=[&quot;$$THEME{nodeletTitleColor}&quot;] colspan=2&gt;
  &lt;font [&quot;$GLOBAL{userFontAttr}&quot;]&gt;&lt;b&gt;Nodelets&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan=2&gt;
[{includeJS: findFormObject, moveSelectItem, selectItem}]
[%
# First, make sure we have the nodelets field filled out
my @nodelets = @{ $NODE-&gt;getNodelets($HTMLVARS{default_nodeletgroup}); };
my $VARS = $NODE-&gt;getVars();
unless(exists $$VARS{nodelets})
{
  my @execnodelets;
  foreach (@nodelets) { push @execnodelets, $_ if getNode($_)-&gt;hasAccess($NODE, 'x') } 
  $$VARS{nodelets} = join(',', @execnodelets);
  $NODE-&gt;setVars($VARS, $USER);
  $NODE-&gt;update($USER);
}

use Everything::HTML::FormObject::SubsetSelector;
my $nodelets = newFormObject('SubsetSelector');
$nodelets-&gt;addType('nodelet', $NODE, 'x', 'labels');
$nodelets-&gt;genObject($query, $NODE, 'vars:nodelets', 'nodelets', 'AUTO',
10, undef, 'Available Nodelets:', 'Selected Nodelets:');
%]
&lt;/td&gt;&lt;/tr&gt;
[%
 my $PN = getNode('personal nodelet', 'nodelet');
 return unless $PN;
 return unless grep /^$$PN{node_id}$/, @{$NODE-&gt;getNodelets($HTMLVARS{default_nodeletgroup})};

 return &quot;&lt;tr bgcolor=\&quot;$$THEME{nodeletTitleColor}\&quot;&gt;&lt;td colspan=2&gt;
  &lt;font $GLOBAL{userFontAttr}&gt;&lt;b&gt;Personal Nodelet&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
 &lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&quot;.htmlsnippet(&quot;editPersonalNodelet&quot;).&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
%]
&lt;/table&gt;
&lt;p&gt;
[{submit}]</field>
  <field name="pagetype_nodetype" type="noderef" type_nodetype="nodetype,nodetype">user</field>
  <field name="parent_container" type="noderef" type_nodetype="container,nodetype">updateFormContainer</field>
  <field name="permissionneeded" type="literal_value">w</field>
  <field name="title" type="literal_value">user edit page</field>
  <field name="type_nodetype" type="noderef" type_nodetype="nodetype,nodetype">htmlpage</field>
</NODE>
