<NODE export_version="0.5" nodetype="htmlcode" title="uploadimage">
  <field type_nodetype="user,nodetype" name="author_user" type="noderef">root</field>
  <field name="authoraccess" type="literal_value">iiii</field>
  <field name="code" type="literal_value"># [{uploadimage:field}]
#
# generates an input file field, and sets the field to the URL 

my ($field) =@_;
my $str ="";
my $name = $field."_file";
my $tmpfile = '/tmp/everythingimage' . rand(10000); 


my $imagedir = '/home/httpd/html/every2/images/incoming';
#you probably need to change this field

my $imageurl = 'images/incoming/';

if ($query->param($name)) {
  my ($fname) = $query->param($name);
  my $imgname = $fname;
  $imgname =~ s/[\/\\]([\w|\.]*)$/$1/;
  $str.= "'". $query->uploadInfo($fname)->{"Content-Type"}."'!";
	
  open OUTFILE, ">$tmpfile";
  my ($buf, $size);
  while (read($fname, $buf, 1024)) { 
    #$size+=$bytes;
    print OUTFILE $buf;
  }
  close OUTFILE;

  `mv $tmpfile $imagedir/$imgname`;
  $$NODE{$field} = $imageurl.$imgname;
  $NODE->update($USER);
 # $str.="$size bytes recieved!";
} else {
  $str.=$query->filefield($name);
  $str .= "&lt;br>NOTE: Image directory is hard-coded in htmlcode:uploadimage&lt;br>";
}
$str;</field>
  <field name="dynamicauthor_permission" type="literal_value">-1</field>
  <field name="dynamicgroup_permission" type="literal_value">-1</field>
  <field name="dynamicguest_permission" type="literal_value">-1</field>
  <field name="dynamicother_permission" type="literal_value">-1</field>
  <field name="group_usergroup" type="literal_value">-1</field>
  <field name="groupaccess" type="literal_value">iiii-</field>
  <field name="guestaccess" type="literal_value">iiii-</field>
  <field type_nodetype="location,nodetype" name="loc_location" type="noderef">htmlcode</field>
  <field name="otheraccess" type="literal_value">iiii-</field>
  <field name="title" type="literal_value">uploadimage</field>
  <field type_nodetype="nodetype,nodetype" name="type_nodetype" type="noderef">htmlcode</field>
</NODE>
