<NODE export_version="0.5" nodetype="htmlcode" title="uploadimage">
  <field type="noderef" type_nodetype="user,nodetype" name="author_user">root</field>
  <field type="literal_value" name="authoraccess">iiii</field>
  <field type="literal_value" name="code"># [{uploadimage:field}]
#
# generates an input file field, and sets the field to the URL 

my ($field) =@_;
my $str ="";
my $name = $field."_file";
my $tmpfile = '/tmp/everythingimage' . rand(10000); 


my $imagedir = '/home/httpd/html/every2/images/incoming';
#you probably need to change this field

my $imageurl = 'images/incoming/';

if ($query->param($name)) {
  my ($fname) = $query->param($name);
  my $imgname = $fname;
  $imgname =~ s/[\/\\]([\w|\.]*)$/$1/;
  $str.= "'". $query->uploadInfo($fname)->{"Content-Type"}."'!";
	
  open OUTFILE, ">$tmpfile";
  my ($buf, $size);
  while (read($fname, $buf, 1024)) { 
    #$size+=$bytes;
    print OUTFILE $buf;
  }
  close OUTFILE;

  `mv $tmpfile $imagedir/$imgname`;
  $$NODE{$field} = $imageurl.$imgname;
  $NODE->update($USER);
 # $str.="$size bytes recieved!";
} else {
  $str.=$query->filefield($name);
  $str .= "&lt;br>NOTE: Image directory is hard-coded in htmlcode:uploadimage&lt;br>";
}
$str;</field>
  <field type="literal_value" name="dynamicauthor_permission">-1</field>
  <field type="literal_value" name="dynamicgroup_permission">-1</field>
  <field type="literal_value" name="dynamicguest_permission">-1</field>
  <field type="literal_value" name="dynamicother_permission">-1</field>
  <field type="literal_value" name="group_usergroup">-1</field>
  <field type="literal_value" name="groupaccess">iiii-</field>
  <field type="literal_value" name="guestaccess">iiii-</field>
  <field type="noderef" type_nodetype="location,nodetype" name="loc_location">htmlcode</field>
  <field type="literal_value" name="otheraccess">iiii-</field>
  <field type="literal_value" name="title">uploadimage</field>
  <field type="noderef" type_nodetype="nodetype,nodetype" name="type_nodetype">htmlcode</field>
</NODE>
