<NODE><INFO>rendered by Everything::XML.pm</INFO>
	<author_user table="node" type="user">root</author_user>
	<code table="htmlcode"># [{uploadimage:field}]
#
# generates an input file field, and sets the field to the URL 

my ($field) =@_;
my $str ="";
my $name = $field."_file";
my $tmpfile = '/tmp/everythingimage' . rand(10000); 
my $imagedir = '/home/httpd/html/every2/images/incoming';
my $imageurl = 'images/incoming/';

if ($query-&gt;param($name)) {
  my ($fname) = $query-&gt;param($name);
  my $imgname = $fname;
  $imgname =~ s/[\/\\]([\w|\.]*)$/$1/;
  $str.= "'". $query-&gt;uploadInfo($fname)-&gt;{"Content-Type"}."'!";
	
  open OUTFILE, "&gt;$tmpfile";
  my ($buf, $size);
  while (read($fname, $buf, 1024)) { 
    #$size+=$bytes;
    print OUTFILE $buf;
  }
  close OUTFILE;

  `mv $tmpfile $imagedir/$imgname`;
  $$NODE{$field} = $imageurl.$imgname;
  $DB-&gt;updateNode ($NODE, $USER);
 # $str.="$size bytes recieved!";
} else {
  $str.=$query-&gt;filefield($name);
  $str .= "&lt;br&gt;NOTE: Image directory is hard-coded in htmlcode:uploadimage&lt;br&gt;";
}
$str;</code>
	<core table="node">R</core>
	<package table="node">0</package>
	<reputation table="node">0</reputation>
	<title table="node">uploadimage</title>
	<type_nodetype table="node" type="nodetype">htmlcode</type_nodetype>
</NODE>
