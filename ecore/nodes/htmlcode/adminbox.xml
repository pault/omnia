<NODE export_version="0.5" nodetype="htmlcode" title="adminbox">
  <field type="noderef" type_nodetype="user,nodetype" name="author_user">root</field>
  <field type="literal_value" name="authoraccess">iiii</field>
  <field type="literal_value" name="code"># This provides links to display, edit, clone, or delete 
# the current node if the user has the authority to do so.  

my $disp = $query->param("displaytype");
my $str;
my @links;

my $CLONER = getNode("node cloner", "restricted_superdoc");
my $PARAMS = { "srcnode_id" => $$NODE{node_id}, 
  "node_id" => $$CLONER{node_id},
  "newname" => "NEWNAME" };

my $url = urlGen($PARAMS);
my $script = "
&lt;script language=\"javascript\">

function cloneNode()
{
  var newname = prompt(\"Cloning node \\\"$$NODE{title}\\\"\\nEnter a new name:\", \"\");

  if(newname)
  {
    var url = $url;
    
    url = url.replace(/NEWNAME/, newname);
    url = url.replace(/ /g, \"%20\");
    parent.location = url;
  }
}

&lt;/script>";

$str = $script;

$disp ||= "display";

# If you want to have other default display links in the
# adminbar, add them to this array.
my @displaytypes = ("display", "edit", "permissions" );

foreach my $type (@displaytypes)
{
  if ($disp eq $type)
  {
    push @links, "&lt;img src=images/icon_".$type."_current.gif alt=".$type." border=0>";
  } 
  else
  {
    push @links, linkNode ($NODE, "&lt;img src=images/icon_".$type.".gif  alt=".$type." border=0>", 
      {displaytype => $type}) . " ";
  }
}

$str.="&lt;table width=100% border=0 cellpadding=3 bgcolor=#FFFFFF cellspacing=1>
         &lt;tr bgcolor=#ffffff> 
           &lt;td bgcolor='#FFCCCC' align='center'>".$links[0].
          "&lt;/td>&lt;td bgcolor='#FF9999' align='center'>".$links[1].
          "&lt;/td>&lt;td bgcolor='#FFCCCC' align='center'>".$links[2].
          "&lt;/td>&lt;/tr>";


$str .= "&lt;tr>&lt;td bgcolor='#FF9999' align='center'>&lt;a href='javascript: cloneNode();'>&lt;img src=images/icon_clone.gif alt=clone border=0>&lt;/a>&lt;/td>
&lt;td bgcolor='#FFCCCC' align=center>";
$str.= htmlcode('clonetotype')."&lt;/td>";
# if a user can delete the node, this places a delete icon in the box.
if($NODE->hasAccess($USER, "d"))
{
$str.="
&lt;SCRIPT language=\"javascript\">
  function confirmDelete(){
    if(confirm(\"Delete '$$NODE{title}'?\")){
      parent.location=" .
        urlGen({node_id=>getId($NODE),op=>"nuke"}) .
		"; }
        }
&lt;/SCRIPT>
&lt;td bgcolor='#FF9999' align=center>&lt;a href='javascript: confirmDelete();'>&lt;img src='images/icon_delete.gif' alt='delete' border=0>&lt;/a>&lt;/td>&lt;/tr>";
}
else
 {
  $str.="&lt;td bgcolor='#FF9999' align=center>&amp;nbsp;&lt;/td>&lt;/tr>";
 }

#another row for undo/delete

my $workspace = 0; #$DB->{workspace}
if ($$NODE{type}{maxrevisions}) {
  my $undo = $NODE->undo($USER, 0, 'test');
  my $redo = $NODE->undo($USER, 1, 'test'); 

  if ($undo or $redo) {
    $str.="&lt;tr>&lt;td bgcolor='#FFCCCC' align=center>";
    if ($undo) {
      $str.=linkNode($NODE, "&lt;IMG src=images/icon_undo.gif alt=\"undo\" border=0>", { op => 'undo', displaytype => $disp });
    } else {
     $str.="&amp;nbsp;";
    }
   $str.="&lt;/td>&lt;td bgcolor='#FF9999' align=center>";
    if ($redo) {
       $str.=linkNode($NODE, "&lt;IMG src=images/icon_redo.gif alt=\"undo\" border=0>", { op => 'redo', displaytype => $disp });
    } else {
      $str.="&amp;nbsp;";
    }
  
   $str.="&lt;/td>&lt;td bgcolor='#FFCCCC' align=center>&amp;nbsp;&lt;/td>&lt;/tr>";

  }

}




# If a group editor is open, add a link to add this node to
# the group.  We will need to check if the nodegroup has
# a restriction on what nodetypes can be in the group.
my $GROUP;
if ($$VARS{group} &amp;&amp;
  ($GROUP = getNode($$VARS{group}, 'light')) &amp;&amp;
  $GROUP->hasAccess($USER, "w"))
{
  $str .=
"&lt;SCRIPT language=\"javascript\">
  function updateGroup() {
  window.open('" . urlGen({node_id => $$VARS{group},
			displaytype => 'editor',
			add => getId($NODE)}, "noquotes") .
		"','". $$VARS{group} ."',
		'');	
  }
&lt;/SCRIPT>
&lt;tr>&lt;td bgcolor='#FFCCCC' align=center colspan=3>&lt;font size=2>&lt;A href=\"javascript:updateGroup()\">add to &amp;quot;$$GROUP{title}&amp;quot;&lt;/a>&lt;/font>&lt;/td>&lt;/tr>";
}

$str.="&lt;/table>";

$str;</field>
  <field type="literal_value" name="dynamicauthor_permission">-1</field>
  <field type="literal_value" name="dynamicgroup_permission">-1</field>
  <field type="literal_value" name="dynamicguest_permission">-1</field>
  <field type="literal_value" name="dynamicother_permission">-1</field>
  <field type="literal_value" name="group_usergroup">-1</field>
  <field type="literal_value" name="groupaccess">iiii-</field>
  <field type="literal_value" name="guestaccess">iiii-</field>
  <field type="noderef" type_nodetype="location,nodetype" name="loc_location">htmlcode</field>
  <field type="literal_value" name="otheraccess">iiii-</field>
  <field type="literal_value" name="title">adminbox</field>
  <field type="noderef" type_nodetype="nodetype,nodetype" name="type_nodetype">htmlcode</field>
</NODE>
