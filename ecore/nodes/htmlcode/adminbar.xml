<NODE export_version="0.5" nodetype="htmlcode" title="adminbar">
  <field type_nodetype="user,nodetype" name="author_user" type="noderef">root</field>
  <field name="authoraccess" type="literal_value">iiii</field>
  <field name="code" type="literal_value">my $disp = $query->param("displaytype");
my $str;
my @links;

my $CLONER = getNode("node cloner", "restricted_superdoc");
my $PARAMS = { "srcnode_id" => $$NODE{node_id}, 
  "node_id" => $$CLONER{node_id},
  "newname" => "NEWNAME" };

my $url = urlGen($PARAMS);
my $script = "
&lt;script language=\"javascript\">

function cloneNode()
{
  var newname = prompt(\"Cloning node \\\"$$NODE{title}\\\"\\nEnter a new name:\", \"\");

  if(newname)
  {
    var url = $url;
    
    url = url.replace(/NEWNAME/, newname);
    url = url.replace(/ /g, \"%20\");
    parent.location = url;
  }
}

&lt;/script>";


$disp ||= "display";

# If you want to have other default display links in the
# adminbar, add them to this array.
my @displaytypes = ("display");

push @displaytypes, ("edit",'permissions') if $NODE->hasAccess($USER,'w');



foreach my $type (@displaytypes)
{
  if ($disp eq $type)
  {
    push @links, $type;
  } 
  else
  {
    push @links, linkNode ($NODE, $type, 
      {displaytype => $type}) . " ";
  }
}

$str .= join " |\n", @links;
$str = "" if $str eq 'display';

$str .= "&lt;br>".$script."&lt;a href='javascript: cloneNode();'>clone&lt;/a>" if $NODE->{type}->hasTypeAccess($USER, 'c');

$str.="
&lt;SCRIPT language=\"javascript\">
  function confirmDelete(){
    if(confirm(\"Delete '$$NODE{title}'?\")){
      parent.location=" .
        urlGen({node_id=>getId($NODE),op=>"nuke"}) .
		"; }
        }
&lt;/SCRIPT>
&lt;br>&lt;font size=1>
&lt;a href='javascript: confirmDelete();'>delete&lt;/a>
&lt;/font>" if($NODE->hasAccess($USER, "d"));

$str;</field>
  <field name="dynamicauthor_permission" type="literal_value">-1</field>
  <field name="dynamicgroup_permission" type="literal_value">-1</field>
  <field name="dynamicguest_permission" type="literal_value">-1</field>
  <field name="dynamicother_permission" type="literal_value">-1</field>
  <field name="group_usergroup" type="literal_value">-1</field>
  <field name="groupaccess" type="literal_value">iiii-</field>
  <field name="guestaccess" type="literal_value">iiii-</field>
  <field type_nodetype="location,nodetype" name="loc_location" type="noderef">htmlcode</field>
  <field name="otheraccess" type="literal_value">iiii-</field>
  <field name="title" type="literal_value">adminbar</field>
  <field type_nodetype="nodetype,nodetype" name="type_nodetype" type="noderef">htmlcode</field>
</NODE>
