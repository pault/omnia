<NODE export_version="0.5" nodetype="restricted_superdoc" title="typeversion controls">
  <field name="author_user" type="noderef" type_nodetype="user,nodetype">root</field>
  <field name="authoraccess" type="literal_value">iiii</field>
  <field name="doctext" type="literal_value">If nodes of a nodetype aren't
updated often, you can save some database resources by only checking
if any nodes of that type have changed instead of checking each node.  
&lt;p>Good nodetypes to turn typeversion on: [nodetype], [htmlpage], [nodemethod], [htmlcode], [container]
or anything else which is rarely updated, but frequently read.
&lt;p>Nodetypes which should &lt;b>NOT&lt;/b> have typeversion on: [user], [document] or any nodetypes
which are frequently updated.

&lt;p>
[{openform}]
&lt;INPUT type=hidden name=confirmpage value=1>
[%
    my $nodetypes = getNodeWhere({type_nodetype => 1 }, "nodetype", "title");
    my $str;
    my %TVERSIONS;
    my %NEWVERSIONS;

    if (my $csr = $DB->sqlSelectMany("*",'typeversion')) {
        while (my $N = $csr->fetchrow_hashref) { $TVERSIONS{$$N{typeversion_id}} = 1 }
        $csr->finish;
    }
if (defined $query->param('confirmpage')) {
    foreach ($query->param) {
        next unless /^typeify_(\d+)$/;
        my $n_id = $1;
        $NEWVERSIONS{$n_id} = 1;
        if (not $TVERSIONS{$n_id}) {
            $DB->sqlInsert("typeversion", { typeversion_id=> $n_id, version => 1 });
        }
    }

    foreach (keys %TVERSIONS) {
        $DB->sqlDelete("typeversion", "typeversion_id=$_") unless exists $NEWVERSIONS{$_};
    }
} else { %NEWVERSIONS = %TVERSIONS }

# Split them into three columns
my @list;

foreach (@$nodetypes)
{
    #nodemethods must be typeversioned (because of the methodCache)
    next if ($$_{title} eq 'nodemethod');
    $str = $query->checkbox('typeify_'.getId($_),
       exists($NEWVERSIONS{getId($_)}), 1, $$_{title}) . "&lt;br>";

    push @list, $str;
}

formatCols(\@list, 3);

%]
[{closeform}]

</field>
  <field name="dynamicauthor_permission" type="literal_value">-1</field>
  <field name="dynamicgroup_permission" type="literal_value">-1</field>
  <field name="dynamicguest_permission" type="literal_value">-1</field>
  <field name="dynamicother_permission" type="literal_value">-1</field>
  <field name="group_usergroup" type="literal_value">-1</field>
  <field name="groupaccess" type="literal_value">iiiii</field>
  <field name="guestaccess" type="literal_value">iiiii</field>
  <field name="loc_location" type="noderef" type_nodetype="location,nodetype">restricted_superdoc</field>
  <field name="otheraccess" type="literal_value">iiiii</field>
  <field name="title" type="literal_value">typeversion controls</field>
  <field name="type_nodetype" type="noderef" type_nodetype="nodetype,nodetype">restricted_superdoc</field>
</NODE>
