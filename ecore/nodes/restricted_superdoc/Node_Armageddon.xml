<NODE export_version="0.5" nodetype="restricted_superdoc" title="Node Armageddon">
  <field name="author_user" type="literal_value">-1</field>
  <field name="authoraccess" type="literal_value">iiii</field>
  <field name="doctext" type="literal_value">&lt;center>&lt;h3>Node Armageddon&lt;/h3>&lt;/center>

[{openform}]

[%
use Everything::FormMenu;

my $menu = new Everything::FormMenu();
my $type = $query->param('whichtype');
$type ||= "alltypes";

$menu->addHash({ "alltypes" => "All Types"});
$menu->addType('nodetype', 1);

$menu->writePopupHTML($query, "whichtype", $type);
%]



[%
my %CLR = (
  document => "#AAAAcc",
  user => "#66dd66",
  usergroup => "#99CC99",
  nodetype => "#CC6666",
  htmlpage => "#CC66CC",
  htmlcode => "#FF99FF",
  hint => "#GAAAAA",
  node => "#FFFFFF",
  superdoc => "#6666CC",
  nodegroup => "#CCCCCC",
  image => "#33CCFF",
  default => '#ffffff',
  container => '#FFCC99',
  nodelet => '#CCFFCC',
  nodeletgroup => '#99FF99'
);

my $type = $query->param('whichtype');
my $ref;
my $offset = $query->param("next");
my $totalRows;
my $limit = 100;
my $next;
my $prev;

$type ||= "alltypes";
$offset ||= 0;

if($type eq "alltypes")
{
  $ref = selectNodeWhere({}, undef,
    "type_nodetype", $limit, $offset, \$totalRows);
}
else
{
  $ref = selectNodeWhere({type_nodetype => $type}, undef, undef, $limit,
    $offset, \$totalRows);
}

return "&lt;p>&lt;b>No Nodes of the selected type&lt;/b>\n"
  unless(defined $ref);

#generate the prev...count...next row
my $nav;
$nav .= "&lt;tr>&lt;td align=left>";
	
$next = ($totalRows > $offset + $limit ? $offset + $limit : $totalRows);	
$prev = ($offset &lt; $limit ? 0 : $offset - $limit);
	
$nav .= "&lt;a href=" .
  urlGen ({node_id => getId ($NODE), next => ($prev) }) . 
  ">Previous " . ($offset-$prev) . " entries...&lt;/a>"
  if ($offset > 0);

$nav .= "&lt;/td>&lt;td align=center>($offset-" . ($offset+int(@$ref)) .
  ") of $totalRows&lt;/td>&lt;td align=right>";
	
$nav .= "&lt;a href=" .
  urlGen ({node_id => getId ($NODE), next => $next}) . 
  ">Next " . ($totalRows - $next > $limit ? $totalRows - $next : $limit) .
  " entries...&lt;/a>" if ($next &lt; $totalRows);

$nav .= "&lt;/td>&lt;/tr>";

#construct the table
my $str = "&lt;TABLE width=100% border=0>";
my $NODEGROUP;

if ($$VARS{group}) {
  my $GR = getNode($$VARS{group}, 'light');

  if($GR->hasAccess($USER, 'w'))
  {
    $NODEGROUP = $GR;
    $str .=
      "&lt;SCRIPT language=\"javascript\">
      function updateMyGroup(nodeid) {
        window.open('" .
        urlGen({node_id => $$VARS{group},
        displaytype => 'editor'}, "noquotes") .
        "&amp;add='+nodeid+'" .  "','". $$VARS{group} ."', '');	
      }
      &lt;/SCRIPT>";
  }
}

$str .= $nav;
$str .= "&lt;tr>&lt;th>Node ID&lt;/td>&lt;th>Title&lt;/th>&lt;th>Type&lt;/th>&lt;/tr>";

for (my $i=0; $i &lt; @$ref; $i++)
{
  my $N = getNode($$ref[$i], 'light');
  $str .= "&lt;tr>&lt;td align=left>&lt;font color=white>".$query->checkbox("killnode".getId($N), 0, 1, "")."&lt;/font>". getId($N);
  if ($NODEGROUP &amp;&amp; (not $NODEGROUP->inGroupFast($N)))
  {
    $str .= "&lt;font size=1>&lt;A href=\"javascript:updateMyGroup(".getId($N).")\">add to &amp;quot;$$NODEGROUP{title}&amp;quot;&lt;/a>&lt;/font>";
  }
  $str .= "&lt;/td>&lt;td bgcolor=#DDCCCC>" . linkNode ($N) .
     "&lt;/td>&lt;td bgcolor=" . 
     ($CLR{$$N{type}{title}} || $CLR{default}) . 
     ">$$N{type}{title}&lt;/td>&lt;/tr>\n" if (ref $$N{type});	
}
$str .= $nav;
	
$str .= "&lt;/TABLE>";
$str.="&lt;br>".$query->submit("node", "the killing floor");
$str.=$query->end_form;
$str;
%]</field>
  <field name="dynamicauthor_permission" type="literal_value">-1</field>
  <field name="dynamicgroup_permission" type="literal_value">-1</field>
  <field name="dynamicguest_permission" type="literal_value">-1</field>
  <field name="dynamicother_permission" type="literal_value">-1</field>
  <field name="group_usergroup" type="literal_value">-1</field>
  <field name="groupaccess" type="literal_value">iiii-</field>
  <field name="guestaccess" type="literal_value">iiii-</field>
  <field type_nodetype="location,nodetype" name="loc_location" type="noderef">restricted_superdoc</field>
  <field name="otheraccess" type="literal_value">iiii-</field>
  <field name="title" type="literal_value">Node Armageddon</field>
  <field type_nodetype="nodetype,nodetype" name="type_nodetype" type="noderef">restricted_superdoc</field>
</NODE>
