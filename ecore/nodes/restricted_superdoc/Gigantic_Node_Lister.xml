<NODE export_version="0.5" nodetype="restricted_superdoc" title="Gigantic Node Lister">
  <field name="author_user" type="noderef" type_nodetype="user,nodetype">root</field>
  <field name="authoraccess" type="literal_value">iiii</field>
  <field name="doctext" type="literal_value">&lt;center>&lt;h3>Gigantic Node Lister&lt;/h3>&lt;/center>

[{openform}]

[%
my $menu = newFormObject("FormMenu");
my $type = $query->param('whichtype');
my $group = $query->param('whichgroup');
my $str;

$type ||= "alltypes";
$group ||= "nogroup";

$menu->addHash({ "alltypes" => "All Types"}, 0);
$menu->addType('nodetype', $USER, 'r', 'labels');
$str .= $menu->genPopupMenu($query, "whichtype", $type);

$menu->clearMenu();
$menu->addHash({ "nogroup" => "No group" }, 0);
$menu->addType('nodegroup', $USER, 'r', 'labels');
$menu->addType('nodeball', $USER, 'r', 'labels');

$str .= $menu->genPopupMenu($query, "whichgroup", $group);
$str .= $query->hidden(-name => 'next', -default => 0);
$str;
%]
[{submit}]

[%
$query->hidden(-name => 'op', -default => 'nodelistcheck', -override => 1) .
$query->hidden(-name => 'next', -default => 0);
%]
[%
my %CLR = (
  document => "#AAAAcc",
  user => "#66dd66",
  usergroup => "#99CC99",
  nodetype => "#CC6666",
  htmlpage => "#CC66CC",
  htmlcode => "#FF99FF",
  node => "#EEEEEE",
  superdoc => "#6666CC",
  nodegroup => "#CCCCCC",
  image => "#33CCFF",
  default => '#AAAAAA',
  container => '#FFCC99',
  nodelet => '#CCFFCC',
  nodeletgroup => '#99FF99',
  location => '#ccAA33',
  opcode => '#AAccAA',
  nodemethod => 'CC9999'
);

my $type   = $query->param('whichtype');
my $group  = $query->param('whichgroup');
my $offset = $query->param("next");
my $limit  = 100;
my ($ref, $totalRows, $next, $prev);

$type   ||= "alltypes";
$offset ||= 0;

if($type eq "alltypes")
{
  $ref = selectNodeWhere({}, undef,
    "type_nodetype", $limit, $offset, \$totalRows);
}
else
{
  $ref = selectNodeWhere({type_nodetype => $type}, undef, undef, $limit,
    $offset, \$totalRows);
}

return "&lt;p>&lt;b>No Nodes of the selected type&lt;/b>\n"
  unless(defined $ref);

#generate the prev...count...next row
my $nav;
$nav .= "&lt;tr>&lt;td align=left>";

$next = ($totalRows > $offset + $limit ? $offset + $limit : $totalRows);	
$prev = ($offset &lt; $limit ? 0 : $offset - $limit);

my $link = {
  node_id => getId( $NODE ),
  whichtype => $type,
  whichgroup => $group,
  next => $prev,
};

$nav .= "&lt;a href=" . urlGen ($link) . 
  ">Previous " . ($offset-$prev) . " entries...&lt;/a>"
  if ($offset > 0);

$nav .= "&lt;/td>&lt;td align=center>($offset-" . ($offset+int(@$ref)) .
  ") of $totalRows&lt;/td>&lt;td align=right>";

$link->{next} = $next;
$nav .= "&lt;a href=" . urlGen ($link) . 
  ">Next " . ($totalRows - $next > $limit ?  $limit : $totalRows - $next ) .
  " entries...&lt;/a>" if ($next &lt; $totalRows);

$nav .= "&lt;/td>&lt;/tr>";

#construct the table
my $str = "&lt;TABLE width=100% border=0>";
my $ngroup = $query->param('whichgroup') || '';
my $NODEGROUP = getNode($ngroup);
my $colfields = { 
    "MAINTAINER" => "author_user",
    "CREATE TIME" => "createtime"};
my @columns = ( "MAINTAINER", "CREATE TIME");
my $linkcols = {  "MAINTAINER" => 1 };
my $gnlcolor = $$THEME{gnlcolor};
$gnlcolor ||= "#DDCCCC";

$str .= $nav;
$str .= "&lt;tr>&lt;TH>NODE ID&lt;/TH>&lt;TH>TITLE&lt;/TH>&lt;TH>&lt;TYPE>&lt;/TH>";
foreach (@columns) {
  $str.="&lt;TH>$_&lt;/TH>";
}
$str.="&lt;/tr>\n";

for (my $i=0; $i &lt; @$ref; $i++)
{
  my $N = getNode($$ref[$i], 'light');

  $str .= "&lt;tr>&lt;td>&lt;font size=-2>";
  $str .= "&lt;input type='checkbox' name='bnode_$$N{node_id}' value='ON' UNCHECKED>";
  $str .= "&lt;/font>"; 
  $str .= getId($N);
  if ($NODEGROUP &amp;&amp; ($NODEGROUP->inGroupFast($N)))
  {
    $str .= " is in '$$NODEGROUP{title}'";
  }

  $str .= "&lt;/td>&lt;td bgcolor=$gnlcolor>" . linkNode ($N) .
     "&lt;/td>&lt;td bgcolor=" . 
     ($CLR{$$N{type}{title}} || $CLR{default}) . 
     ">$$N{type}{title}&lt;/td>" if (ref $$N{type});
  foreach (@columns) {
    $str.="&lt;td bgcolor=$gnlcolor>";
    if (exists($$linkcols{$_})) {
       $str.= linkNode($$N{$$colfields{$_}})
    } else { $str.= $$N{$$colfields{$_}}; }
    $str.="&lt;/td>";
  }	
  $str.="&lt;/tr>";
}
$str .= $nav;
	
$str .= "&lt;/TABLE>";
$str;
%]

[{submit:addtonb,Add checked to Node Bucket}]
[{submit:massacre,Send to the killing floor}]
[%
$query->endform;
%]</field>
  <field name="dynamicauthor_permission" type="literal_value">-1</field>
  <field name="dynamicgroup_permission" type="literal_value">-1</field>
  <field name="dynamicguest_permission" type="literal_value">-1</field>
  <field name="dynamicother_permission" type="literal_value">-1</field>
  <field name="group_usergroup" type="literal_value">-1</field>
  <field name="groupaccess" type="literal_value">iiii-</field>
  <field name="guestaccess" type="literal_value">iiii-</field>
  <field name="loc_location" type="noderef" type_nodetype="location,nodetype">restricted_superdoc</field>
  <field name="otheraccess" type="literal_value">iiii-</field>
  <field name="title" type="literal_value">Gigantic Node Lister</field>
  <field name="type_nodetype" type="noderef" type_nodetype="nodetype,nodetype">restricted_superdoc</field>
</NODE>
