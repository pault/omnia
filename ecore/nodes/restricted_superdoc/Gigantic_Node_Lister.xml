<NODE export_version="0.5" nodetype="restricted_superdoc" title="Gigantic Node Lister">
  <field name="author_user" type="literal_value">-1</field>
  <field name="authoraccess" type="literal_value">iiii</field>
  <field name="doctext" type="literal_value">&lt;center>&lt;h3>Gigantic Node Lister&lt;/h3>&lt;/center>

[{openform}]

[%
use Everything::FormMenu;

my $menu = new Everything::FormMenu();
my $type = $query->param('whichtype');
my $group = $query->param('whichgroup');
my $str;

$type ||= "alltypes";
$group ||= "nogroup";

$menu->addHash({ "alltypes" => "All Types"});
$menu->addType('nodetype', 1);

$str .= $menu->writePopupHTML($query, "whichtype", $type);

$menu = new Everything::FormMenu();
$menu->addHash({ "nogroup" => "No group" });
$menu->addType('nodegroup', 1);
$menu->addType('nodeball', 1);

$str .= $menu->writePopupHTML($query, "whichgroup", $group);

$str .= $query->hidden(-name => 'next', -default => 0);

$str;
%]

[{closeform}]

[{openform}]
[%
$query->hidden(-name => 'op', -default => 'addBucket', -override => 1) .
$query->hidden(-name => 'next', -default => 0);
%]
[%
my %CLR = (
  document => "#AAAAcc",
  user => "#66dd66",
  usergroup => "#99CC99",
  nodetype => "#CC6666",
  htmlpage => "#CC66CC",
  htmlcode => "#FF99FF",
  node => "#EEEEEE",
  superdoc => "#6666CC",
  nodegroup => "#CCCCCC",
  image => "#33CCFF",
  default => '#AAAAAA',
  container => '#FFCC99',
  nodelet => '#CCFFCC',
  nodeletgroup => '#99FF99',
  location => '#ccAA33',
  opcode => '#AAccAA',
  nodemethod => 'CC9999'
);

my $type = $query->param('whichtype');
my $ref;
my $offset = $query->param("next");
my $totalRows;
my $limit = 100;
my $next;
my $prev;

$type ||= "alltypes";
$offset ||= 0;

if($type eq "alltypes")
{
  $ref = selectNodeWhere({}, undef,
    "type_nodetype", $limit, $offset, \$totalRows);
}
else
{
  $ref = selectNodeWhere({type_nodetype => $type}, undef, undef, $limit,
    $offset, \$totalRows);
}

return "&lt;p>&lt;b>No Nodes of the selected type&lt;/b>\n"
  unless(defined $ref);

#generate the prev...count...next row
my $nav;
$nav .= "&lt;tr>&lt;td align=left>";
	
$next = ($totalRows > $offset + $limit ? $offset + $limit : $totalRows);	
$prev = ($offset &lt; $limit ? 0 : $offset - $limit);
	
$nav .= "&lt;a href=" .
  urlGen ({node_id => getId ($NODE), next => ($prev) }) . 
  ">Previous " . ($offset-$prev) . " entries...&lt;/a>"
  if ($offset > 0);

$nav .= "&lt;/td>&lt;td align=center>($offset-" . ($offset+int(@$ref)) .
  ") of $totalRows&lt;/td>&lt;td align=right>";
	
$nav .= "&lt;a href=" .
  urlGen ({node_id => getId ($NODE), next => $next}) . 
  ">Next " . ($totalRows - $next > $limit ? $totalRows - $next : $limit) .
  " entries...&lt;/a>" if ($next &lt; $totalRows);

$nav .= "&lt;/td>&lt;/tr>";

#construct the table
my $str = "&lt;TABLE width=100% border=0>";
my $NODEGROUP = getNode($query->param('whichgroup'));

$str .= $nav;
$str .= "&lt;tr>&lt;th>Node ID&lt;/td>&lt;th>Title&lt;/th>&lt;th>Type&lt;/th>&lt;/tr>";

for (my $i=0; $i &lt; @$ref; $i++)
{
  my $N = getNode($$ref[$i], 'light');

  $str .= "&lt;tr>&lt;td>&lt;font size=1>";
  $str .= "&lt;input type='checkbox' name='bnode_$$N{node_id}' value='ON' UNCHECKED>";
  $str .= "&lt;/font>";
  $str .= getId($N);
  if ($NODEGROUP &amp;&amp; ($NODEGROUP->inGroupFast($N)))
  {
    $str .= " is in '$$NODEGROUP{title}'";
  }

  $str .= "&lt;/td>&lt;td bgcolor=#DDCCCC>" . linkNode ($N) .
     "&lt;/td>&lt;td bgcolor=" . 
     ($CLR{$$N{type}{title}} || $CLR{default}) . 
     ">$$N{type}{title}&lt;/td>&lt;/tr>\n" if (ref $$N{type});	
}
$str .= $nav;
	
$str .= "&lt;/TABLE>";
$str;
%]

[{submit:addtonb,Add checked to Node Bucket}]
[%
$query->endform;
%]</field>
  <field name="dynamicauthor_permission" type="literal_value">-1</field>
  <field name="dynamicgroup_permission" type="literal_value">-1</field>
  <field name="dynamicguest_permission" type="literal_value">-1</field>
  <field name="dynamicother_permission" type="literal_value">-1</field>
  <field name="group_usergroup" type="literal_value">-1</field>
  <field name="groupaccess" type="literal_value">iiii-</field>
  <field name="guestaccess" type="literal_value">iiii-</field>
  <field type_nodetype="location,nodetype" name="loc_location" type="noderef">restricted_superdoc</field>
  <field name="otheraccess" type="literal_value">iiii-</field>
  <field name="title" type="literal_value">Gigantic Node Lister</field>
  <field type_nodetype="nodetype,nodetype" name="type_nodetype" type="noderef">restricted_superdoc</field>
</NODE>
