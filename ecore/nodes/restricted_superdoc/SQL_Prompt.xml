<NODE export_version="0.5" nodetype="restricted_superdoc" title="SQL Prompt">
  <field type="noderef" type_nodetype="user,nodetype" name="author_user">root</field>
  <field type="literal_value" name="authoraccess">iiii</field>
  <field type="literal_value" name="doctext">[%
my $str;
my $execstr = $query->param("sqlquery");

$str = $query->start_multipart_form("POST",
  $ENV{script_name}) . "\n";
$str .= $query->hidden("displaytype") . "\n";
$str .= $query->hidden("node_id", getId($NODE)) . "\n";
$str .= "SQL Query:\n";
$str .= $query->textfield("sqlquery", $execstr, 60);
$str .= $query->submit('execsql', 'Execute') . "\n";
$str .= $query->end_form;

$str;
%]

&lt;p>
[%
my $execstr = $query->param("sqlquery");
my $str = "";

if($execstr)
{
  my $cursor = $DB->getDatabaseHandle()->prepare($execstr);

  if($cursor->execute())
  {
    my $ROW;
    while($ROW = $cursor->fetchrow_hashref())
    {
      if($str eq "")
      {
        $str = "&lt;table border=1>\n";
        $str .= " &lt;tr>\n";
        foreach (keys %$ROW)
        {
          $_ = "&amp;nbsp;" if((not defined $_) || ($_ eq "")); 
          $str .= "  &lt;td align=\"center\" bgcolor=\"#CC99CC\">$_&lt;/td>\n";
        }
        $str .= " &lt;/tr>\n";
      }

      $str .= " &lt;tr>\n";
      my ($k, $v);
      foreach (keys %$ROW)
      {
        $k = $_;  $v = $$ROW{$_};
        $v = encodeHTML($v, 1) if(defined $v);
        $v = linkNode($v, $v) if(($k =~ /_/) &amp;&amp; (not ($v =~ /\D/)));
        $v = "&amp;nbsp;" if((not defined $v) || ($v eq ""));
        $str .= "  &lt;td>&lt;pre>$v&lt;/pre>&lt;/td>\n";
      }
      $str .= " &lt;/tr>\n";
    }
	$cursor->finish();
    $str .= "&lt;/table>\n";
  }
}

$str;
%]</field>
  <field type="literal_value" name="dynamicauthor_permission">-1</field>
  <field type="literal_value" name="dynamicgroup_permission">-1</field>
  <field type="literal_value" name="dynamicguest_permission">-1</field>
  <field type="literal_value" name="dynamicother_permission">-1</field>
  <field type="literal_value" name="group_usergroup">-1</field>
  <field type="literal_value" name="groupaccess">iiii-</field>
  <field type="literal_value" name="guestaccess">iiii-</field>
  <field type="noderef" type_nodetype="location,nodetype" name="loc_location">restricted_superdoc</field>
  <field type="literal_value" name="otheraccess">iiii-</field>
  <field type="literal_value" name="title">SQL Prompt</field>
  <field type="noderef" type_nodetype="nodetype,nodetype" name="type_nodetype">restricted_superdoc</field>
</NODE>
