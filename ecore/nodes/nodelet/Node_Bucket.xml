<NODE export_version="0.5" nodetype="nodelet" title="Node Bucket">
  <field type="noderef" type_nodetype="user,nodetype" name="author_user">root</field>
  <field type="literal_value" name="authoraccess">iiii</field>
  <field type="literal_value" name="dynamicauthor_permission">-1</field>
  <field type="literal_value" name="dynamicgroup_permission">-1</field>
  <field type="literal_value" name="dynamicguest_permission">-1</field>
  <field type="literal_value" name="dynamicother_permission">-1</field>
  <field type="literal_value" name="group_usergroup">-1</field>
  <field type="literal_value" name="groupaccess">iiii-</field>
  <field type="literal_value" name="guestaccess">iiii-</field>
  <field type="noderef" type_nodetype="location,nodetype" name="loc_location">nodelet</field>
  <field type="literal_value" name="mini_nodelet">0</field>
  <field type="literal_value" name="nlcode">[%
return "" unless($NODE->hasAccess($USER, "w"));

my $PARAMS = { op => 'addBucket', "bnode_" . $$NODE{node_id} => 1 };
linkNode($NODE, "Add '$$NODE{title}'", $PARAMS);
%]

[%
$query->start_multipart_form("POST", $ENV{script_name}) .
$query->hidden("displaytype") .
$query->hidden("node_id", $$NODE{node_id}) .
$query->hidden(-name => "op", -default => "bucketop", -override => 1);
%]

[%
my @bnodes;
@bnodes = split ',', $$VARS{nodebucket} if (defined($$VARS{nodebucket}));
my $isLoc = $NODE->isOfType("location");
my $isGroup = $NODE->isGroup();
my $str;

return "Empty&lt;br>\n" unless(@bnodes);

foreach my $node (@bnodes)
{
  getRef($node);

  # Can't use CGI::checkbox here because it insists on having a label...
  $str .= "&lt;INPUT TYPE='checkbox' NAME='bnode_$$node{node_id}' " .
     "VALUE='ON' UNCHECKED>";
  $str .= linkNode($node) . "&lt;br>\n";
}

$str .= "&lt;font size=1>\n";

$str .= "&lt;INPUT TYPE='checkbox' NAME='dropexec' VALUE='ON' CHECKED>" .
  "Execute and drop&lt;br>\n" if($isLoc or $isGroup);

if($isLoc)
{
  $str .= $query->submit( -name => "bmove", -value => "Move" ) . "\n";
  $str .= $query->submit( -name => "bsymlink", -value => "Symlink" ) . "\n";
}
elsif($isGroup)
{
  $str .= $query->submit( -name => "bgroupadd", -value => "Add to Group") ."\n";
}

$str .= $query->submit( -name => "bdrop", -value => "Drop" ) . "\n";

$str .= "&lt;/font>\n";
$str .= $query->end_form;

$str;
%]</field>
  <field type="literal_value" name="nlgoto">0</field>
  <field type="literal_value" name="nltext">&lt;A HREF="/index.pl?node_id=199&amp;bnodes=199&amp;lastnode_id=199&amp;op=addBucket">Add 'Node Bucket'&lt;/a>

&lt;FORM METHOD="POST"  ENCTYPE="multipart/form-data">
&lt;INPUT TYPE="hidden" NAME="node_id" VALUE="199">&lt;INPUT TYPE="hidden" NAME="op" VALUE="bucketop">

Empty&lt;br>
</field>
  <field type="literal_value" name="otheraccess">iiii-</field>
  <field type="noderef" type_nodetype="container,nodetype" name="parent_container">general nodelet container</field>
  <field type="literal_value" name="title">Node Bucket</field>
  <field type="noderef" type_nodetype="nodetype,nodetype" name="type_nodetype">nodelet</field>
  <field type="literal_value" name="updateinterval">0</field>
</NODE>
