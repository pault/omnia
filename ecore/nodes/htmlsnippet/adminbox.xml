<NODE export_version="0.5" nodetype="htmlsnippet" title="adminbox">
  <field name="author_user" type="noderef" type_nodetype="user,nodetype">root</field>
  <field name="authoraccess" type="literal_value">iiii</field>
  <field name="code" type="literal_value">[%
my $NODE = $this-&gt;get_node;
my $THEME = $this-&gt;get_theme;
my $query = $this-&gt;get_query;
my %GLOBAL;
my $str;

#Setup

# This provides links to display, edit, clone, or delete
# the current node if the user has the authority to do so.  
my $disp = $query-&gt;param(&quot;displaytype&quot;);
$disp ||= &quot;display&quot;;

$GLOBAL{adminboxLinks} = {};

# If you want to have other default display links in the
# adminbar, add them to this array.
my @displaytypes = (&quot;display&quot;, &quot;edit&quot;, &quot;permissions&quot; );
# Now theme stuff
$GLOBAL{adminboxBG} = $$THEME{adminboxBG};
$GLOBAL{adminboxBG} ||= &quot;#ffffff&quot;;
$GLOBAL{adminboxLite} = $$THEME{adminboxLite};
$GLOBAL{adminboxLite} ||= &quot;#ffcccc&quot;;
$GLOBAL{adminboxDark} = $$THEME{adminboxDark};
$GLOBAL{adminboxDark} ||= &quot;#ff9999&quot;;

foreach my $type (@displaytypes)
{
  if ($disp eq $type)
  {
    $GLOBAL{adminboxLinks}{$type} = 
      &quot;&lt;img src=images/icon_&quot;.$type.&quot;_current.gif alt=&quot;.$type.&quot; border=0 height=\&quot;20\&quot; width=\&quot;48\&quot;&gt;&quot;;
  } 
  else
  {
    $GLOBAL{adminboxLinks}{$type} =  linkNode ($NODE,
      &quot;&lt;img src=images/icon_&quot;.$type.&quot;.gif  alt=&quot;.$type.&quot; border=0 height=\&quot;20\&quot; width=\&quot;48\&quot;&gt;&quot;, 
      {displaytype =&gt; $type}) . &quot; &quot;;
  }
}




$str.=&quot;&lt;table width=100% border=0 cellpadding=3 bgcolor=$GLOBAL{adminboxBG} cellspacing=1&gt;
  &lt;tr bgcolor=$GLOBAL{adminboxBG}&gt; 
    &lt;td bgcolor=\&quot;$GLOBAL{adminboxLite}\&quot; align=\&quot;center\&quot;&gt;
$GLOBAL{adminboxLinks}{display}
    &lt;/td&gt;&quot;;

$str.=qq|    &lt;td bgcolor=&quot;$GLOBAL{adminboxDark}&quot; align=&quot;center&quot;&gt;
$GLOBAL{adminboxLinks}{edit}
    &lt;/td&gt;|;
$str.=qq|&lt;td bgcolor=&quot;$GLOBAL{adminboxLite}&quot; align=&quot;center&quot;&gt;
$GLOBAL{adminboxLinks}{permissions}
    &lt;/td&gt;
  &lt;/tr&gt;|;

$str.=qq|  &lt;tr&gt;
    &lt;td bgcolor=&quot;$GLOBAL{adminboxDark}&quot; align=&quot;center&quot;&gt;
      &lt;a href=&quot;javascript: cloneNode();&quot;&gt;
       &lt;img src=images/icon_clone.gif alt=clone border=0 height=&quot;20&quot; width=&quot;48&quot;&gt;&lt;/a&gt;
    &lt;/td&gt;
    &lt;td bgcolor=&quot;$GLOBAL{adminboxLite}&quot; align=center&gt;|;
 $str.= $this-&gt;clonetotype();
$str.=qq|    &lt;/td&gt;|;
$str.=qq|   &lt;td bgcolor=&quot;$GLOBAL{adminboxDark}&quot; align=&quot;center&quot;&gt;|;

if($NODE-&gt;hasAccess($USER, &quot;d&quot;))
{
  $str .= &quot;&lt;a href='javascript: confirmDelete();'&gt;&quot;;
  $str .= &quot;&lt;img src='images/icon_delete.gif' alt='delete' border=0 height=\&quot;20\&quot; width=\&quot;48\&quot;&gt;&lt;/a&gt;&quot;;
}
else
{
  $str .= &quot;&amp;nbsp;&quot;;
}
$str .=q|
    &lt;/td&gt;
  &lt;/tr&gt;|;

#another row for undo/delete
my $workspace = 0;
my $disp = $query-&gt;param('displaytype');
$disp ||= 'display';

if ($$NODE{type}{maxrevisions})
{
  my $undo = $NODE-&gt;undo($USER, 0, 'test');
  my $redo = $NODE-&gt;undo($USER, 1, 'test'); 

  if ($undo or $redo)
  {
    $str.=&quot;&lt;tr&gt;&lt;td bgcolor='$GLOBAL{adminboxLite}' align=center&gt;&quot;;
    if ($undo) {
      $str.=linkNode($NODE,
        &quot;&lt;IMG src=images/icon_undo.gif alt=\&quot;undo\&quot; border=0 height=\&quot;20\&quot; width=\&quot;48\&quot;&gt;&quot;,
        { op =&gt; 'undo', displaytype =&gt; $disp });
    } else {
      $str.=&quot;&amp;nbsp;&quot;;
    }

    $str.=&quot;&lt;/td&gt;&lt;td bgcolor='$GLOBAL{adminboxDark}' align=center&gt;&quot;;

    if ($redo) {
       $str.= $this-&gt;link_node($NODE,
         &quot;&lt;IMG src=images/icon_redo.gif alt=\&quot;undo\&quot; border=0 height=\&quot;20\&quot; width=\&quot;48\&quot;&gt;&quot;,
         { op =&gt; 'redo', displaytype =&gt; $disp });
    } else {
      $str.=&quot;&amp;nbsp;&quot;;
    }
  
   $str.=&quot;&lt;/td&gt;&lt;td bgcolor='$GLOBAL{adminboxLite}' align=center&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&quot;;

  }
}

$str .= q|&lt;/table&gt;|;
%]</field>
  <field name="dynamicauthor_permission" type="literal_value">-1</field>
  <field name="dynamicgroup_permission" type="literal_value">-1</field>
  <field name="dynamicguest_permission" type="literal_value">-1</field>
  <field name="dynamicother_permission" type="literal_value">-1</field>
  <field name="group_usergroup" type="literal_value">-1</field>
  <field name="groupaccess" type="literal_value">iiii-</field>
  <field name="guestaccess" type="literal_value">iiii-</field>
  <field name="loc_location" type="noderef" type_nodetype="location,nodetype">htmlcode</field>
  <field name="otheraccess" type="literal_value">iiii-</field>
  <field name="title" type="literal_value">adminbox</field>
  <field name="type_nodetype" type="noderef" type_nodetype="nodetype,nodetype">htmlsnippet</field>
</NODE>
